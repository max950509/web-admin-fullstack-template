# 本地开发指南

虽然我们强烈推荐使用 Docker 进行开发以保证环境一致性，但您也可以选择在本地直接运行前后端服务。本指南将引导您完成本地开发环境的配置。

## 1. 环境要求

在开始之前，请确保您的系统中已安装以下软件：

*   **Node.js**: `v22.x` 或更高版本
*   **pnpm**: `v9.x` 或更高版本
*   **PostgreSQL**: `v16.x` 或更高版本
*   **Redis**: `v7.x` 或更高版本

## 2. 安装项目依赖

在项目根目录下执行以下命令，pnpm 会自动安装所有工作区（前端、后端）的依赖：

```bash
pnpm install
```

## 3. 后端服务配置与启动

### 3.1. 配置环境变量

1.  复制环境变量文件：
    ```bash
    cp backend/nestjs/.env.example backend/nestjs/.env
    ```
2.  编辑 `backend/nestjs/.env` 文件，确保以下配置正确无误：
    *   `DATABASE_URL`: 指向您本地 PostgreSQL 数据库的连接字符串。
        *   格式: `postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=public`
        *   例如: `postgresql://postgres:postgres@localhost:5432/web_admin?schema=public`
    *   `REDIS_HOST`: 您本地 Redis 服务的主机地址（通常是 `localhost`）。
    *   `REDIS_PORT`: 您本地 Redis 服务的端口（通常是 `6379`）。

### 3.2. 数据库配置

1.  **生成 Prisma Client**:
    此命令会根据 `prisma/schema.prisma` 文件生成类型安全的数据库客户端。
    ```bash
    pnpm --filter backend-nestjs exec prisma generate
    ```

2.  **执行数据库迁移**:
    此命令会读取 `prisma/migrations` 目录下的迁移文件，并将数据库结构更新到最新状态。
    ```bash
    pnpm --filter backend-nestjs exec prisma migrate dev
    ```

3.  **（可选）填充初始数据**:
    如果您需要一套初始的管理员账号、角色和权限，可以执行 `seed` 脚本。
    ```bash
    pnpm --filter backend-nestjs exec ts-node src/seed.ts
    ```
    > **警告**: `seed` 脚本会清空现有数据，请谨慎操作。

### 3.3. 启动后端服务

执行以下命令以热重载模式启动 NestJS 服务：

```bash
pnpm --filter backend-nestjs start:dev
```

服务启动后，默认监听在 `http://localhost:3030`。

## 4. 前端服务启动

### 4.1. 配置环境变量

前端项目依赖于 Vite 在构建时注入的环境变量。默认配置位于 `frontend/react18/.env.development`，通常无需修改：

*   `VITE_APP_BASE=/`
*   `VITE_APP_API_BASE=/api`

### 4.2. 启动前端开发服务器

执行以下命令启动 Vite 开发服务器：

```bash
pnpm --filter frontend-react18 dev
```

服务启动后，默认监听在 `http://localhost:8080`。Vite 会自动处理对后端 `/api` 的代理请求，相关配置在 `vite.config.ts` 中。

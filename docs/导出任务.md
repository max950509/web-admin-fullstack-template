# 导出任务

为了避免大数据导出阻塞请求，导出采用 BullMQ + Redis 异步任务。

## 1. 任务生命周期

- 创建：`POST /export-tasks`
- 执行：Worker 消费队列
- 状态：`pending -> running -> success/failed`
- 下载：`GET /export-tasks/:id/download`

## 2. 核心表结构

`ExportTask` 记录导出过程：

- `type`：导出类型（当前只有 `account`）
- `status`：任务状态
- `format`：csv/xlsx
- `params`：查询参数
- `fileName` / `filePath`
- `createdById`

## 3. 队列与执行

- 队列：BullMQ（Redis 连接复用现有配置）
- Worker 处理逻辑：
  1) 读任务
  2) 调用 handler 导出
  3) 写文件并更新状态

## 4. 扩展性设计

新增导出只需：

1. 新建 exporter（如 `role-export.handler.ts`）
2. 注册到 `ExportTaskService.getHandler()`
3. 增加权限 / 前端入口

`type` 就是路由到不同导出逻辑的分发键。

